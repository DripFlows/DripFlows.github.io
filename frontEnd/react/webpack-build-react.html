<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>引言 | DripFlows</title>
    <meta name="description" content="待补充">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.28ef1fef.css" as="style"><link rel="preload" href="/assets/js/app.7355eab2.js" as="script"><link rel="preload" href="/assets/js/2.132a57af.js" as="script"><link rel="preload" href="/assets/js/24.7ae352e2.js" as="script"><link rel="prefetch" href="/assets/js/10.740b5f64.js"><link rel="prefetch" href="/assets/js/11.78082b06.js"><link rel="prefetch" href="/assets/js/12.96589dd2.js"><link rel="prefetch" href="/assets/js/13.82b7dda1.js"><link rel="prefetch" href="/assets/js/14.6c0337ad.js"><link rel="prefetch" href="/assets/js/15.4580a59e.js"><link rel="prefetch" href="/assets/js/16.dd06d4f0.js"><link rel="prefetch" href="/assets/js/17.7ce49614.js"><link rel="prefetch" href="/assets/js/18.fb2319df.js"><link rel="prefetch" href="/assets/js/19.29154b75.js"><link rel="prefetch" href="/assets/js/20.ba78d04c.js"><link rel="prefetch" href="/assets/js/21.edc9c9c6.js"><link rel="prefetch" href="/assets/js/22.777eaed4.js"><link rel="prefetch" href="/assets/js/23.d05fe0b4.js"><link rel="prefetch" href="/assets/js/25.f458ff03.js"><link rel="prefetch" href="/assets/js/26.02148a11.js"><link rel="prefetch" href="/assets/js/27.e92b4339.js"><link rel="prefetch" href="/assets/js/28.316df1f3.js"><link rel="prefetch" href="/assets/js/29.7ca7db8a.js"><link rel="prefetch" href="/assets/js/3.4df34556.js"><link rel="prefetch" href="/assets/js/30.eed17a97.js"><link rel="prefetch" href="/assets/js/31.91dad760.js"><link rel="prefetch" href="/assets/js/32.8d597ba3.js"><link rel="prefetch" href="/assets/js/33.16a09da9.js"><link rel="prefetch" href="/assets/js/34.45c4d2e6.js"><link rel="prefetch" href="/assets/js/4.663fdb84.js"><link rel="prefetch" href="/assets/js/5.ed1cff9d.js"><link rel="prefetch" href="/assets/js/6.a180e42e.js"><link rel="prefetch" href="/assets/js/7.101c3ea0.js"><link rel="prefetch" href="/assets/js/8.38b06e0d.js"><link rel="prefetch" href="/assets/js/9.5d56b8fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.28ef1fef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DripFlows</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">🌟博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link router-link-active">前端</a></li><li class="dropdown-item"><!----> <a href="/backEnd/" class="nav-link">后端</a></li><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">💻项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/DripFlows/chrome-helper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chrome-helper
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/suggestions/" class="nav-link">📚推荐</a></div><div class="nav-item"><a href="/todo/" class="nav-link">💡Todo</a></div><div class="nav-item"><a href="https://github.com/DripFlows" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">🌟博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link router-link-active">前端</a></li><li class="dropdown-item"><!----> <a href="/backEnd/" class="nav-link">后端</a></li><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">💻项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/DripFlows/chrome-helper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chrome-helper
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/suggestions/" class="nav-link">📚推荐</a></div><div class="nav-item"><a href="/todo/" class="nav-link">💡Todo</a></div><div class="nav-item"><a href="https://github.com/DripFlows" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/frontEnd/" class="sidebar-link">欢迎</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontEnd/react/hook-in-project.html" class="sidebar-link">React Hook在项目</a></li><li><a href="/frontEnd/react/webpack-build-react.html" class="active sidebar-link">用webpack搭建前端项目的一点点心得</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#webpack" class="sidebar-link">webpack</a></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#构建项目" class="sidebar-link">构建项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#一、技术栈" class="sidebar-link">一、技术栈</a></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#二、兼容性" class="sidebar-link">二、兼容性</a></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#三、-编码规范" class="sidebar-link">三、 编码规范</a></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#四、前端监控和优化" class="sidebar-link">四、前端监控和优化</a></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#四、本项目中不重要的一些规范" class="sidebar-link">四、本项目中不重要的一些规范</a></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#五、一些优化点" class="sidebar-link">五、一些优化点</a></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#六、后续的计划" class="sidebar-link">六、后续的计划</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontEnd/react/webpack-build-react.html#结束语" class="sidebar-link">结束语</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="引言"><a href="#引言" aria-hidden="true" class="header-anchor">#</a> 引言</h2> <p>最近开始做自己的博客站，因为是自己的项目不赶进度不赶时间，也不需要做的多花哨，所以就不打算用网上那些现成的优秀构建工具来启项目，而是自己从webpack+react开始来搭建一个简陋的伪工程化前端项目，顺便也多了解一点webpack，然后再实际开发中在一点一点摸索和完善项目</p> <p><img src="http://www.phplaozhang.com/uploads/layedit/20170622/960a6050ece1854caf016b6b04856d32.jpg" alt="别跑"></p> <h2 id="webpack"><a href="#webpack" aria-hidden="true" class="header-anchor">#</a> webpack</h2> <p>聊起webpack，就不得不说起前端的工程化。随着JavaScript的不断做大做强，前端做的不仅仅是一些页面展示和页面特效，而是有了越来越多的用户交互和用户体验方面的优化，并且一些业务场景也能从后端解放出来转而倾向前端。前端工程师们要面对的不再是简简单单的网站，而是更为复杂的 web 应用，这意味着前端项目构建必须要往更加系统化的工程的方向去构建。</p> <p>想起开始学前端的时候，就简单的一个页面一个文件搞定+html/css/js全部写在一起，毫无疑问这样开发效率很低而且会做很多多余且重复的工作，所以就需要把把前端项目当成一项系统工程进行分析、组织、构建，在开发层面做的更加的组件化、模块化、规范化等，使得项目结构清晰、减少冗余工作量和提高工作效率。</p> <blockquote><p>实际上前端工程化还涉及到构建/部署/测试/自动化/性能/稳定性/可用性/可维护性，还包括里面的一些部署/发布/CI/CD/灰度等概念可不是一两句话就能说清的</p></blockquote> <p>基于上述背景，前端诞生了一系列的譬如Grunt / Gulp / Webpack / Rollup等等等等优秀的前端构建打包模块化工具，每种工具各有适用场景和不如其他工具擅长的功能，这边能就不再展开描述了，这篇文章主要讲述结合webpack构建前端项目的思路以及一些常见的优化点</p> <p><strong>摘一下webpack的概念</strong></p> <blockquote><p>本质上，<em>webpack</em> 是一个现代 JavaScript 应用程序的<em>静态模块打包器(module bundler)</em>。当 webpack 处理应用程序时，它会递归地构建一个<em>依赖关系图(dependency graph)</em>，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 <em>bundle</em>。</p></blockquote> <p><strong>再偷一下webpack的图</strong></p> <p>![image-20200511230228015](/Users/wuqingfu/Library/Application Support/typora-user-images/image-20200511230228015.png)</p> <p>上面的概念和图足以传达webpack的思想和作用了，总结来说就一句话：前端工程中，咱只管开发就成了，构建神马的全一股脑儿交给webpack。</p> <p>网上特别多关于从0开始手把手教操作搭建项目的优秀文章，这篇文章也是借鉴了大佬文章来学习使用webpack===&gt;<a href="https://juejin.im/post/5eb79fbb5188256b246a1308" target="_blank" rel="noopener noreferrer">webpack 搭建简单 React 项目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，所以这边也直接掠过本人粗浅的webpack理解篇幅，直接进入构建过程</p> <h2 id="构建项目"><a href="#构建项目" aria-hidden="true" class="header-anchor">#</a> 构建项目</h2> <p>俗话说，没有规矩不成方圆，每做一个项目之前，都需要先想好这个工程的初衷、预期以及可能出现的不可抗力因素（比如说那天突然不想继续写了...）。所以在初始化项目之前，需要对这个项目做一个简单的规划，以便于后续的开发迭代和维护</p> <p><strong>项目结构</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>├── dist                        编译后项目文件
├── node_modules                依赖包
├── public                      静态资源文件
├── script                      构建文件
│   ├── analyzer.js               分析包大小    
│   ├── build.js                  打包    
│   ├── dll.js                    抽离公共的依赖    
│   ├── start.js                  开发环境启动    
│   ├── webpack.base.config.js    webpack基础配置    
├── src                         源码
│   ├── pages                     页面组件
│   ├── <span class="token punctuation">..</span>.												其它
│   ├── index.tsx                 入口文件
├── .babelrc                    babel 配置
├── .eslintrc.js                eslint 配置
├── .gitignore                  忽略提交到git目录文件
├── .prettierrc                 代码美化
├── package.json                依赖包及配置信息文件
├── tsconfig.json               typescript 配置
├── README.md                   描述文件
</code></pre></div><p>因为本篇讲的侧重点是理论，所以对源码讲的比较少。所以这边简单描述一下script下的各个文件：</p> <ul><li><p>webpack.base.config.js</p> <p>这是一个基础的webpack文件，配置了包括入口、输出、解析模块、代码压缩去重、拆包提取、html模版等基本配置。为什么会需要抽出来，主要出于两点来考量</p> <ol><li>抽离公共代码，使得代码更加简洁明了</li> <li>保证开发和生产环境尽量一致，避免一些因为环境差异带来的无意义问题</li></ol></li> <li><p>start.js</p> <p>项目开发环境启动的入口，这边聚合了基础配置和开发时的配置，譬如devServer/HMR等开发环境配置项</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NoEmitOnErrorsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>build</p> <p>项目打包构建入口，除了基本配置，还包括一些构建性能监控代码等。譬如使用HappyPack来加快打包速度：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  threads<span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> <span class="token string">'jsx'</span><span class="token punctuation">,</span>
  loaders<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>dll.js</p> <p>抽离第三方模块,减少构建体积</p></li> <li><p>analyzer.js</p> <p>打包构建完成之后，需要对包的拆分大小等做个详细的分析，有利于对拆包和代码结构调整做进一步的优化</p></li></ul> <h3 id="一、技术栈"><a href="#一、技术栈" aria-hidden="true" class="header-anchor">#</a> 一、技术栈</h3> <p>前端技术选型基本绕不开三大框架react/vue/angular，每个框架都有适用和不适用的场景，还有框架带来的生态系统、学习成本、稳定性和配合基础构建的能力等等等等一系列等考量。</p> <p>因为是个人项目所以就直接考虑用typescript+react全家桶开发了,配置也是比较简单</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// babel编译 .babelrc配置</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/.jsx?$/</span><span class="token punctuation">,</span>
  exclude<span class="token punctuation">:</span> <span class="token regex">/(node_modules|bower_components)/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 使用typescript</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.(ts|tsx)$/</span><span class="token punctuation">,</span>
  exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  	loader<span class="token punctuation">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/react&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/preset-env&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/transform-runtime&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="二、兼容性"><a href="#二、兼容性" aria-hidden="true" class="header-anchor">#</a> 二、兼容性</h3> <p>前端项目绕不开的一个点就是兼容性的问题了，前端兼容性问题主要有两个策略</p> <ul><li><p>渐进增强</p> <p>渐进增强保证低版本浏览器的体验，对于支持新特性的新浏览器提供稍好的体验</p></li> <li><p>优雅降级</p> <p>优雅降级则是相反的，为现代浏览器提供最好的体验，而旧浏览器则退而求之次，保证大概的功能</p></li></ul> <p>这边选用的是优雅降级的策略（因为实际上就没想过低版本浏览器的兼容=.=）</p> <h3 id="三、-编码规范"><a href="#三、-编码规范" aria-hidden="true" class="header-anchor">#</a> 三、 编码规范</h3> <p>项目的编码规范也是老生常谈的话题了，良好的编码习惯利于长期维护项目，提高开发效率和代码质量，减少遗留系统维护的负担，可以少背因为垃圾代码而带来的技术债。</p> <p>网上常用且推荐使用的都是eslint来约束代码规范，再用Prettier来美化，最后用husky来限制提交</p> <p>不过因为本人对自己的编码风格有足够的自信，所以这次项目就一个都没用</p> <p><img src="http://biaoqingbao.xin/wp-content/uploads/2017/10/1685.jpg" alt="膨胀的很"></p> <h3 id="四、前端监控和优化"><a href="#四、前端监控和优化" aria-hidden="true" class="header-anchor">#</a> 四、前端监控和优化</h3> <p>一个成熟的网站，必然有配套有成熟的监控系统来支撑。而好的监控系统不仅能帮我做到网站的pv/uv/用户习惯/用户行为等分析统计，更有及时发现系/处理统异常，排查错误，避免严重的生产故障的能力。</p> <p>虽然是个人的咸鱼站点，但是梦想还是要有的，考虑到本人以后可能会火，所以防患于未然到网上一些监控统计系统。找了一圈要么就是要花钱（口袋空空，没有预算），要么就是没找到符合预期效果的，所以就自己写了几个埋点接口（<a href="https://juejin.im/post/5eb3e1b4e51d45244e7c2d09" target="_blank" rel="noopener noreferrer">参照上期文章中的接口实现部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），聊胜于无吧，仅用于监控异常和统计分析，方便于后续系统的持续优化</p> <h3 id="四、本项目中不重要的一些规范"><a href="#四、本项目中不重要的一些规范" aria-hidden="true" class="header-anchor">#</a> 四、本项目中不重要的一些规范</h3> <p>还有很多对于团队项目来说很重要的规范，但是因为这个项目是个人项目，所以这边就简单提一下：</p> <ol><li>代码分支管理</li> <li>流程规范</li> <li>协作规范</li> <li>合理明确分工</li> <li>发布构建流程</li> <li>代码质量规范</li> <li>代码风格规范</li> <li>代码提炼/复盘</li> <li>测试规范</li> <li>持续维护计划</li> <li>文档规范</li> <li>...</li></ol> <h3 id="五、一些优化点"><a href="#五、一些优化点" aria-hidden="true" class="header-anchor">#</a> 五、一些优化点</h3> <h4 id="动态引入"><a href="#动态引入" aria-hidden="true" class="header-anchor">#</a> 动态引入</h4> <p>对于一些公共的模块，譬如路由或者redux等，可以通过webpack的require.context模块来动态引入</p> <ol><li><p>动态导入路由</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> RouteMap <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment">// 白名单</span>
<span class="token keyword">const</span> <span class="token constant">WHITE_LIST</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span>
<span class="token comment">// NOTE: 默认不考虑路由传参的情况[xxx/:id],这种场景还没想好用什么方式来解决</span>
<span class="token comment">// 动态读取pages下的所有目录，把每个目录都当成一个路由</span>
<span class="token keyword">const</span> files <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./pages'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/\/index\.jsx$/</span><span class="token punctuation">)</span>
files<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// const pattern = /(?&lt;=\/).+(?=\/)/</span>
  <span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token regex">/\.\/(.+)\/(\w+)\.jsx?$/</span>
  <span class="token keyword">const</span> route <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token comment">// 白名单路由跳过</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">WHITE_LIST</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    RouteMap<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> route<span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> <span class="token function">files</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>default
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">LayoutRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Layout <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span> RouteMap<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>path<span class="token punctuation">,</span> component<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Route key<span class="token operator">=</span><span class="token punctuation">{</span>path<span class="token punctuation">}</span> exact path<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/app/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span> component<span class="token operator">=</span><span class="token punctuation">{</span>component<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这样，就不需要每次都要引入一个路由文件，把路由文件映射到对应的路由上了，只要规则定的多，定的好，甚至连配置路由文件那一步都可以通过这种方式来实现。</p></li> <li><p>动态注册redux模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 自动注册reducer模块</span>
<span class="token keyword">let</span> rootReducer <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> reducersFiles <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./reducers'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token regex">/\.js$/</span><span class="token punctuation">)</span>
reducersFiles<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">filename</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// const pattern = /(?&lt;=\.\/).+(?=\.js)/ 新语法，部分浏览器还不支持</span>
  <span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token regex">/\/(\w+)\.jsx?$/</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> matchRes <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> matchRes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    rootReducer<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">reducersFiles</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span>default
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'无法注册'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 自动注册saga模块</span>
<span class="token keyword">let</span> rootSagaList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> sagaFiles <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./sagas'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token regex">/\.js/</span><span class="token punctuation">)</span>
sagaFiles<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">filename</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rootSagaList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token function">sagaFiles</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <p>通过require.context，就能够省掉很多无用且重复的代码，至少不需要再一个个模块文件的导入了，后续可以学一下dva思路，再进行一层包装，当然这是后话了。</p> <h4 id="babel-优化"><a href="#babel-优化" aria-hidden="true" class="header-anchor">#</a> babel 优化</h4> <p>因为浏览器之间的兼容性问题还有浏览器实现w3c规范的时间差异，为了避免我们用的api在浏览器上还没实现，所以一般前端项目都会引入babel做一个编译。引入这边编译工具，也需要能够对项目结构进行一些简单的优化</p> <ol><li><p>排除 node_modules/bower_components 编译， exclude: /(node_modules|bower_components)/</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.base.config.js</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/.jsx?$/</span><span class="token punctuation">,</span>
  exclude<span class="token punctuation">:</span> <span class="token regex">/(node_modules|bower_components)/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>使用@babel/transform-runtime抽出公共模块，减小代码体积</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .babelrc</span>
<span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;@babel/transform-runtime&quot;</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>使用happypack，开启多个线程</p> <p>因为webpack啥单线程的，所以有时候我们并不能充分利用到现代cpu多核的优势，所以需要想办法利用这个优势来提高打包编译效率，这时候就可以用到HappyPack来做这样的事情了，让任务分解给多个子进程做并发执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span>
<span class="token comment">// 手动创建进程池</span>
<span class="token keyword">const</span> happyThreadPool <span class="token operator">=</span>  HappyPack<span class="token punctuation">.</span><span class="token function">ThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span> size<span class="token punctuation">:</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.ts$/</span><span class="token punctuation">,</span>
        <span class="token comment">// 问号后面的查询参数指定了处理这类文件的HappyPack实例的名字</span>
        loader<span class="token punctuation">:</span> <span class="token string">'happypack/loader?id=happyBabel'</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>
    <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 这个HappyPack的“名字”就叫做happyBabel，和楼上的查询参数遥相呼应</span>
      id<span class="token punctuation">:</span> <span class="token string">'happyBabel'</span><span class="token punctuation">,</span>
      <span class="token comment">// 指定进程池</span>
      threadPool<span class="token punctuation">:</span> happyThreadPool<span class="token punctuation">,</span>
      loaders<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h4 id="打包性能监控"><a href="#打包性能监控" aria-hidden="true" class="header-anchor">#</a> 打包性能监控</h4> <p>如果我们打包体积过大，那么体现在使用上就会导致页面加载时间特别长，这样是非常非常不好的一个体验，所以需要有一个提示机制，当我们打包文件过大的时候，我们能够及时知道文件大小，webpack<em>也提供了非常方便的功能</em><code>performance</code></p> <div class="language-js extra-class"><pre class="language-js"><code>performance<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  hints<span class="token punctuation">:</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token comment">// 提示类型</span>
    <span class="token comment">// 定一个创建后超过 200kb 的资源，将展示一条警告</span>
    maxAssetSize<span class="token punctuation">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">200</span><span class="token punctuation">,</span>
    maxEntrypointSize<span class="token punctuation">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">200</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样，我们就能及时发现打包中出现的大体积包，然后对打包和开发做进一步的优化</p> <h4 id="抽离第三方依赖"><a href="#抽离第三方依赖" aria-hidden="true" class="header-anchor">#</a> 抽离第三方依赖</h4> <p>webpack提供了非常好的一个功能<code>DllPlugin</code>,它能够很好的把第三方依赖抽离出来，然后生产一个映射文件<code>manifest.json</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">OUTPUT_PATH</span> <span class="token operator">=</span> <span class="token constant">BUILD_OUTPUT_DIR</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BUILD_OUTPUT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib/</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'dist/lib'</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
	plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
		<span class="token comment">// 抽离包的插件</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			context<span class="token punctuation">:</span> __dirname<span class="token punctuation">,</span>
			path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">OUTPUT_PATH</span><span class="token punctuation">,</span> <span class="token string">'manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			name<span class="token punctuation">:</span> <span class="token string">'[name]-[hash]'</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>把包抽离出来后，就需要通过这个映射文件去使用这些包，这时候就会用到<code>DllReferencePlugin</code>映射到相关的依赖上去的，这时候启动项目，就可以正常使用这些依赖了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  context<span class="token punctuation">:</span> __dirname<span class="token punctuation">,</span>
  sourceType<span class="token punctuation">:</span> <span class="token string">&quot;commonjs2&quot;</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'lib_dll'</span><span class="token punctuation">,</span>
  manifest<span class="token punctuation">:</span> dllMap <span class="token comment">// manifest.json地址</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="splitchunks"><a href="#splitchunks" aria-hidden="true" class="header-anchor">#</a> splitChunks</h4> <p>webpack4.x后提供了更加方便的拆包功能<code>splitChunks</code>，算是一个优化版的<code>DllPlugin</code>吧</p> <p><em>Tips：不知道是不是配置问题，本来在同时用的时候会导致一些包被打包两次，反而增大了体积</em></p> <div class="language-js extra-class"><pre class="language-js"><code>optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>	
		<span class="token comment">// 打包后再拆包</span>
    splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 这表示将选择哪些块进行优化。当提供一个字符串，有效值为 all, async 和 initial. 提供 all 可以特别强大，因为这意味着即使在异步和非异步块之间也可以共享块。</span>
      chunks<span class="token punctuation">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
      <span class="token comment">// 要生产的块最小大小（以字节为单位）</span>
      minSize<span class="token punctuation">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
      maxSize<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token comment">// 分割前必须共享模块的最小块数</span>
      minChunks<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token comment">// 按需加载时的最大并行请求数</span>
      maxAsyncRequests<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token comment">// 入口点处的最大并行请求数</span>
      maxInitialRequests<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token comment">// 指定用于生成的名称的分割符 vendors~main.js</span>
      automaticNameDelimiter<span class="token punctuation">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
      <span class="token comment">// 拆分块的名称</span>
      name<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 抽出css</span>
        <span class="token comment">// styles: {</span>
        <span class="token comment">//   name: 'static/css/styles',</span>
        <span class="token comment">//   test: /\.(css|scss|sass)$/,</span>
        <span class="token comment">//   chunks: 'all',</span>
        <span class="token comment">//   enforce: true,</span>
        <span class="token comment">// },</span>
        <span class="token comment">// 抽出公共模块</span>
        commons<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'static/js/components'</span><span class="token punctuation">,</span>
          test<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'src/components'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          minChunks<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 单独抽出react</span>
        react<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/](react)[\\/]/</span><span class="token punctuation">,</span>
          name<span class="token punctuation">:</span> <span class="token string">'static/js/react'</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 单独抽出react-dom</span>
        reactDom<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/](react-dom)[\\/]/</span><span class="token punctuation">,</span>
          name<span class="token punctuation">:</span> <span class="token string">'static/js/react-dom'</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 抽出第三方的包</span>
        vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'static/js/vendors'</span><span class="token punctuation">,</span>
          test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>上面的配置把一个公用的组件还有比较大的依赖都抽离出来了，webpack会把react-dom/react/其它第三方依赖都抽离出来，分别生成三个文件，当然，如果有其它比较大的依赖的话，也可以再加规则抽离出来</p> <h3 id="六、后续的计划"><a href="#六、后续的计划" aria-hidden="true" class="header-anchor">#</a> 六、后续的计划</h3> <ol><li>持续优化webpack配置</li> <li>引入eslint 规范代码</li> <li>引入jest实现单元测试</li> <li>构建缓存策略，优化用户体验</li> <li>改造项目为ssr/服务端渲染</li> <li>抽离公用组件，构建组件库</li> <li>优化前端监控模块</li> <li>...</li></ol> <h2 id="结束语"><a href="#结束语" aria-hidden="true" class="header-anchor">#</a> 结束语</h2> <p>纸上得来总觉浅，绝知此事要躬行，以前看别人随随便便搭建一个项目感觉没啥，轮到自己做的时候就感觉秃顶发凉，仅以此篇，祭奠那些离我而去的头发吧。</p> <p><img src="https://pic1.zhimg.com/80/v2-df4636a21ecd987c10de850af7ef3370_1440w.jpg" alt="知识盲区"></p> <p>👏 <a href="https://github.com/tguzi/drip-flow-web" target="_blank" rel="noopener noreferrer">github 仓库地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2020/5/15 下午7:05:13</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/frontEnd/react/hook-in-project.html" class="prev">
          React Hook在项目
        </a></span> <span class="next"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html">
          从Object.defineProperty到Proxy
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7355eab2.js" defer></script><script src="/assets/js/2.132a57af.js" defer></script><script src="/assets/js/24.7ae352e2.js" defer></script>
  </body>
</html>
